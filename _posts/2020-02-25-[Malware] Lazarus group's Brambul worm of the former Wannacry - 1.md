---
title: "[Malware] Lazarus group's Brambul worm of the former Wannacry - 1"
tags: [악성코드, 라자루스, 북한, 워너크라이, 웜, malware, wannacry, lazarus, worm, north korea, english]
---

# Relationship with WannaCry and Brambul
---

WannaCry is a ransomware of the North Korean Lazarus Group that hit the pandemic in May 2017.
Attackers earned about $ 150,000 through this ransomware, and the damage from the attack is estimated at about billions of dollars.
One of the features of WannaCry is that it replicates itself and distributes it to an accessible network, similar to a worm, and is distributed primarily through SMB vulnerabilities and email.

Prior to WannaCry, the Lazarus group deployed a worm that behaved in a similar way, one of which is the worm named Brambul.
WannaCry is a mutation of the ransomware form of this worm called Brambul.

![1](https://cdn5.alienvault.com/blog-content/Screen_Shot_2018-02-08_at_5.42.47_PM.png)

[Edit from Intezer tech report ](http://www.intezer.com/wp-content/uploads/2017/07/Intezer-WannaCry.pdf)

Brambul was created in 2009 and began to be distributed. After 10 years, it's not dangerous compared to other malware, but it can still harm computers with vulnerable versions and settings.

# Analysis
---
MD5 :  [f024ff4176f0036f97ebc95decfd1d5e](https://www.hybrid-analysis.com/sample/7b2f8c43b4c92fb2add9fce264e92668dac2530493c51c5d6b45dcb764e208ed/?environmentId=100)

Running the file does not seem to have any effect on your screen.
There is no packing or obfuscation, so it is easy to analyze.
Thanks to this, you can roughly predict behavior with just the strings contained within the file.


## Strings in file
---
![strings](https://i.imgur.com/xgpGboe.png)

Based on the above information, you can infer emails, IP addresses, registry changes, shared folder access, and related processes.


## Start of behavior
---
![mainfunc](https://i.imgur.com/nLWaVUt.png)

![findusername](https://i.imgur.com/cKclzgO.png)

When the program starts up, it calls the WSAStartup function to check if a network connection is available.
Get the user's name (the name of the PC). For my PC, I got the value "swan".
Then push the string "gmail.com" onto the stack and call dnsquery as follows:

![dnsquery](https://i.imgur.com/O0B3XUC.png)

After that, the user's name is verified as "System", and the behavior is divided into two routine to the result.

![checksystem](https://i.imgur.com/nu7Qqd2.png)

![branch](https://i.imgur.com/GhWLwo9.png)


## First routine
---

In this case, we call the sub_402900 subroutine, which generates IP addresses randomly after a few GetTickCounts.
It will try to connect to 445 port (SMB port) with randomly generated IP.

![iptosmb](https://i.imgur.com/bykvnRb.png)

![445port](https://i.imgur.com/UUWYUUZ.png)

![connections](https://i.imgur.com/5slnWx2.png)

If the connection to the SMB port is successful, the connection to the IPC is attempted.

![ipcconnect](https://i.imgur.com/Ymvu1X4.png)

If the connection to IPC succeeds, the administrator account accesses the SCM database and performs malicious actions.

![scm1](https://i.imgur.com/VmvgAtB.png)

![scm2](https://i.imgur.com/jN1KzYh.png)

>1. Send mail using the SMTP protocol to the specified subject at whiat1001@gmail.com
>2. Access shared folder with admin
>3. Create a Windows Genuine Logon Manager (wglmgr) Service
>4. Create a Microsoft Windows Genuine Updater (wgudtr) Service
>5. Generate crss.exe executable

These generated services and executables seem to cause the routine to self-replicate and propagate, after which the first routine is terminated.

[(Continued from Part 2)](https://metaswan.github.io/posts/Malware-Lazarus-group's-Brambul-worm-of-the-former-Wannacry-2)
