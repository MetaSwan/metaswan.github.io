---
title: "[Malware] Lazarus group's Brambul worm of the former Wannacry - 2"
tags: [악성코드, 라자루스, 북한, 워너크라이, 웜, malware, wannacry, lazarus, worm, north korea, english]
---


# Analysis
---

Continued by [[Malware] Lazarus group's Brambul worm of the former Wannacry - 1](https://metaswan.github.io/posts/Malware-Lazarus-group's-Brambul-worm-of-the-former-Wannacry-1)

## Second routine
---

As soon as the second routine starts, three subroutines are called: sub_401ba0, sub_401b30, and sub_401040.

![secondroutine](https://i.imgur.com/YHZW75Y.png)

### sub_401ba0 
Create the lsasvc.exe file and run the process.
Afterwards, access the shared folder as admin like the first routine.

![401ba0_first](https://i.imgur.com/XqDL9Nk.png)

![401ba0_second](https://i.imgur.com/wuRTvDI.png)

---

### sub_401b30 
By adding a value named "WindowsUpdate" to the registry "Software \ Microsoft \ Windows \ CurrentVersion \ Run" path, the process will automatically run each time the computer is turned on.

![401b30](https://i.imgur.com/ps1yBs7.png)

---

### sub_401040 
Similar to what it did at the beginning of the program run, the gethostname function gets the user's name.

![401040](https://i.imgur.com/AdreJ8I.png)

---

After the three subroutines are executed, the GetVersion function is used to get the version of the operating system.
I could see that it was classified as "WinNt", "Win2000", "WinVista", "Win2003", "WinXp", and "Unkonwn".

![getversion](https://i.imgur.com/tf9xlZV.png)

After that, it push the string whiat1001@gmail.com onto the stack and call the sub_401430 subroutine to transfer data using the SMTP protocol and the process ends. In sub_401430 we could see the strings related to SMTP and mail headers.

![mailstrings](https://i.imgur.com/8i8Zlp5.png)

---

# Behavior result

>1. SMB, IPC ,SCM Database access attempt with random IPs for self-copy and distribution
>2. Send mail to whiat1001@gmail.com using SMTP protocol
>3. Access shared folder as admin
>4. Create the Windows Genuine Logon Manager (wglmgr) service
>5. Create the Microsoft Windows Genuine Updater (wgudtr) service
>6. Create crss.exe executable
>7. Create and run lsasvc.exe
>8. Add "WindowsUpdate" Value to the registry "Software \ Microsoft \ Windows \ CurrentVersion \ Run" path
